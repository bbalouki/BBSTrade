<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Backtesting Egine &mdash; BBSTrader 0.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=a58bc63e"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="MetaTrader5 (MT5) Trading" href="metatrader.html" />
    <link rel="prev" title="bbstrader" href="modules.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BBSTrader
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">bbstrader</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Backtesting Egine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#components">Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.backtest">backtest</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.ArimaGarchStrategyBacktester"><code class="docutils literal notranslate"><span class="pre">ArimaGarchStrategyBacktester</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.Backtest"><code class="docutils literal notranslate"><span class="pre">Backtest</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.KLFStrategyBacktester"><code class="docutils literal notranslate"><span class="pre">KLFStrategyBacktester</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.OUStrategyBacktester"><code class="docutils literal notranslate"><span class="pre">OUStrategyBacktester</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.SMAStrategyBacktester"><code class="docutils literal notranslate"><span class="pre">SMAStrategyBacktester</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.backtest.run_backtest"><code class="docutils literal notranslate"><span class="pre">run_backtest()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.data">data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.data.BaseCSVDataHandler"><code class="docutils literal notranslate"><span class="pre">BaseCSVDataHandler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.data.DataHandler"><code class="docutils literal notranslate"><span class="pre">DataHandler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.data.HistoricCSVDataHandler"><code class="docutils literal notranslate"><span class="pre">HistoricCSVDataHandler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.data.MT5HistoricDataHandler"><code class="docutils literal notranslate"><span class="pre">MT5HistoricDataHandler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.data.YFHistoricDataHandler"><code class="docutils literal notranslate"><span class="pre">YFHistoricDataHandler</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.event">event</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.event.Event"><code class="docutils literal notranslate"><span class="pre">Event</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.event.FillEvent"><code class="docutils literal notranslate"><span class="pre">FillEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.event.MarketEvent"><code class="docutils literal notranslate"><span class="pre">MarketEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.event.OrderEvent"><code class="docutils literal notranslate"><span class="pre">OrderEvent</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.event.SignalEvent"><code class="docutils literal notranslate"><span class="pre">SignalEvent</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.execution">execution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.execution.ExecutionHandler"><code class="docutils literal notranslate"><span class="pre">ExecutionHandler</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.execution.SimulatedExecutionHandler"><code class="docutils literal notranslate"><span class="pre">SimulatedExecutionHandler</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.performance">performance</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.create_drawdowns"><code class="docutils literal notranslate"><span class="pre">create_drawdowns()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.create_sharpe_ratio"><code class="docutils literal notranslate"><span class="pre">create_sharpe_ratio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.create_sortino_ratio"><code class="docutils literal notranslate"><span class="pre">create_sortino_ratio()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.plot_monthly_yearly_returns"><code class="docutils literal notranslate"><span class="pre">plot_monthly_yearly_returns()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.plot_performance"><code class="docutils literal notranslate"><span class="pre">plot_performance()</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="#btengine.performance.plot_returns_and_dd"><code class="docutils literal notranslate"><span class="pre">plot_returns_and_dd()</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.portfolio">portfolio</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.portfolio.Portfolio"><code class="docutils literal notranslate"><span class="pre">Portfolio</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#module-btengine.strategy">strategy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#btengine.strategy.Strategy"><code class="docutils literal notranslate"><span class="pre">Strategy</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="metatrader.html">MetaTrader5 (MT5) Trading</a></li>
<li class="toctree-l2"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l2"><a class="reference internal" href="strategies.html">Strategies</a></li>
<li class="toctree-l2"><a class="reference internal" href="trading.html">Trading Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="tseries.html">Time Series</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BBSTrader</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">bbstrader</a></li>
      <li class="breadcrumb-item active">Backtesting Egine</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/btengine.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-btengine">
<span id="backtesting-egine"></span><h1>Backtesting Egine<a class="headerlink" href="#module-btengine" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This Backtesting Module provides a comprehensive suite of tools to test trading strategies in an event-driven system.
It simulates the execution of trades in historical market conditions to evaluate the performance of trading strategies
before applying them in live trading environments. Designed with modularity and extensibility in mind, it caters to
both novices and experts in algorithmic trading.</p>
</section>
<section id="features">
<h2>Features<a class="headerlink" href="#features" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Event-Driven Architecture</strong>: Processes market data, generates signals, executes orders, and manages portfolio updates in response to events, closely mimicking live trading environments.</p></li>
<li><p><strong>Historical Market Data Support</strong>: Utilizes historical OHLCV data from CSV files, Yahoo finance and MT5 terminal allowing for the testing of strategies over various market conditions and time frames.</p></li>
<li><p><strong>Strategy Implementation Flexibility</strong>: Abstract base classes for strategies and other components enable users to define custom trading logic and data handling processes.</p></li>
<li><p><strong>Performance Metrics Calculation</strong>: Includes tools for calculating key performance indicators, such as <cite>Sharpe Ratio</cite>, <cite>Sortino Ratio</cite>, and <cite>drawdowns</cite>, to evaluate the effectiveness of trading strategies.</p></li>
<li><p><strong>Visualization</strong>: Generates plots of the <cite>equity curve</cite>, <cite>returns</cite>, <cite>drawdowns</cite>, and other metrics for comprehensive strategy <cite>performance analysis</cite>.</p></li>
</ul>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><strong>Backtest</strong>: Orchestrates the backtesting process, managing events and invoking components.</p></li>
<li><p><strong>Event</strong>: Abstract class for events, with implementations for market data, signals, fill and order events.</p></li>
<li><p><strong>DataHandler</strong>: Abstract class for market data handling, with an implementation for <cite>HistoricalCSVHandler</cite>, <cite>MT5HistoricDataHandler</cite>, <cite>YFHistoricDataHandler</cite>. We will add another data handling in the future such as MacroEconomic Data, Fundamental Data, TICK Data and Real-time Data.</p></li>
<li><p><strong>Strategy</strong>: Abstract class for trading strategies, allowing for custom signal generation logic.</p></li>
<li><p><strong>Portfolio</strong>: Manages positions and calculates performance metrics, responding to market data and signals.</p></li>
<li><p><strong>ExecutionHandler</strong>: Abstract class for order execution, with a simulated execution handler provided with an implementation for <cite>SimulatedExecutionHandler</cite>.</p></li>
<li><p><strong>Performance</strong>: Utility functions for calculating performance metrics and visualizing strategy performance.</p></li>
</ul>
<p>Examples:
&gt;&gt;&gt; from bbstrader.btengine import run_backtest
&gt;&gt;&gt; run_backtest(test_mode=True, test_strategy=’ou’, test_quantity=2000)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">run_backtest</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">symbol_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GOOG&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">data_handler</span><span class="o">=</span><span class="n">CustomDataHandler</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">strategy</span><span class="o">=</span><span class="n">MovingAverageStrategy</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">exc_handler</span><span class="o">=</span><span class="n">CustomExecutionHandler</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">initial_capital</span><span class="o">=</span><span class="mf">500000.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">heartbeat</span><span class="o">=</span><span class="mf">1.0</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="module-btengine.backtest">
<span id="backtest"></span><h2>backtest<a class="headerlink" href="#module-btengine.backtest" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.backtest.ArimaGarchStrategyBacktester">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">ArimaGarchStrategyBacktester</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bars</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#ArimaGarchStrategyBacktester"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.ArimaGarchStrategyBacktester" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></p>
<p>The <cite>ArimaGarchStrategyBacktester</cite> class extends the <cite>Strategy</cite>
class to implement a backtesting framework for trading strategies based on
ARIMA-GARCH models, incorporating a Hidden Markov Model (HMM) for risk management.</p>
<section id="id1">
<h3>Features<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>ARIMA-GARCH Model</strong>: Utilizes ARIMA for time series forecasting and GARCH for volatility forecasting, aimed at predicting market movements.</p></li>
<li><p><strong>HMM Risk Management</strong>: Employs a Hidden Markov Model to manage risks, determining safe trading regimes.</p></li>
<li><p><strong>Event-Driven Backtesting</strong>: Capable of simulating real-time trading conditions by processing market data and signals sequentially.</p></li>
</ul>
</section>
<section id="key-methods">
<h3>Key Methods<a class="headerlink" href="#key-methods" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><cite>get_data()</cite>: Retrieves and prepares the data required for ARIMA-GARCH model predictions.</p></li>
<li><p><cite>create_signal()</cite>: Generates trading signals based on model predictions and current market positions.</p></li>
<li><p><cite>calculate_signals(event)</cite>: Listens for market events and triggers signal creation and event placement.</p></li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.ArimaGarchStrategyBacktester.calculate_signals">
<span class="sig-name descname"><span class="pre">calculate_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#ArimaGarchStrategyBacktester.calculate_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.ArimaGarchStrategyBacktester.calculate_signals" title="Link to this definition"></a></dt>
<dd><p>Provides the mechanisms to calculate the list of signals.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.ArimaGarchStrategyBacktester.create_signal">
<span class="sig-name descname"><span class="pre">create_signal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#ArimaGarchStrategyBacktester.create_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.ArimaGarchStrategyBacktester.create_signal" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.ArimaGarchStrategyBacktester.get_data">
<span class="sig-name descname"><span class="pre">get_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#ArimaGarchStrategyBacktester.get_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.ArimaGarchStrategyBacktester.get_data" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.backtest.Backtest">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">Backtest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_capital</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">heartbeat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">execution_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ExecutionHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Strategy</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#Backtest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.Backtest" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The <cite>Backtest()</cite> object encapsulates the event-handling logic and essentially
ties together all of the other classes.</p>
<p>The Backtest object is designed to carry out a nested while-loop event-driven system
in order to handle the events placed on the <cite>Event</cite> Queue object.
The outer while-loop is known as the “heartbeat loop” and decides the temporal resolution of
the backtesting system. In a live environment this value will be a positive number,
such as 600 seconds (every ten minutes). Thus the market data and positions
will only be updated on this timeframe.</p>
<p>For the backtester described here the “heartbeat” can be set to zero,
irrespective of the strategy frequency, since the data is already available by virtue of
the fact it is historical! We can run the backtest at whatever speed we like,
since the event-driven system is agnostic to when the data became available,
so long as it has an associated timestamp.</p>
<p>The inner while-loop actually processes the signals and sends them to the correct
component depending upon the event type. Thus the Event Queue is continually being
populated and depopulated with events. This is what it means for a system to be event-driven.</p>
<p>The initialisation of the Backtest object requires the full <cite>symbol list</cite> of traded symbols,
the <cite>initial capital</cite>, the <cite>heartbeat</cite> time in milliseconds, the <cite>start datetime</cite> stamp
of the backtest as well as the <cite>DataHandler</cite>, <cite>ExecutionHandler</cite>, <cite>Strategy</cite> objects
and additionnal <cite>kwargs</cite> based on the <cite>ExecutionHandler</cite>, the <cite>DataHandler</cite>, and the <cite>Strategy</cite> used.</p>
<p>A Queue is used to hold the events. The signals, orders and fills are counted.
For a <cite>MarketEvent</cite>, the <cite>Strategy</cite> object is told to recalculate new signals,
while the <cite>Portfolio</cite> object is told to reindex the time. If a <cite>SignalEvent</cite>
object is received the <cite>Portfolio</cite> is told to handle the new signal and convert it into a
set of <cite>OrderEvents</cite>, if appropriate. If an <cite>OrderEvent</cite> is received the <cite>ExecutionHandler</cite>
is sent the order to be transmitted to the broker (if in a real trading setting).
Finally, if a <cite>FillEvent</cite> is received, the Portfolio will update itself to be aware of
the new positions.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.Backtest.simulate_trading">
<span class="sig-name descname"><span class="pre">simulate_trading</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#Backtest.simulate_trading"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.Backtest.simulate_trading" title="Link to this definition"></a></dt>
<dd><p>Simulates the backtest and outputs portfolio performance.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.backtest.KLFStrategyBacktester">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">KLFStrategyBacktester</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bars</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events_queue</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#KLFStrategyBacktester"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.KLFStrategyBacktester" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></p>
<p>The <cite>KLFStrategyBacktester</cite> class implements a backtesting framework for a
[pairs trading](<a class="reference external" href="https://en.wikipedia.org/wiki/Pairs_trade">https://en.wikipedia.org/wiki/Pairs_trade</a>) strategy using
Kalman Filter for signals and Hidden Markov Models (HMM) for risk management.
This document outlines the structure and usage of the <cite>KLFStrategyBacktester</cite>,
including initialization parameters, main functions, and an example of how to run a backtest.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.KLFStrategyBacktester.calc_slope_intercep">
<span class="sig-name descname"><span class="pre">calc_slope_intercep</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prices</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#KLFStrategyBacktester.calc_slope_intercep"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.KLFStrategyBacktester.calc_slope_intercep" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.KLFStrategyBacktester.calculate_signals">
<span class="sig-name descname"><span class="pre">calculate_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#KLFStrategyBacktester.calculate_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.KLFStrategyBacktester.calculate_signals" title="Link to this definition"></a></dt>
<dd><p>Calculate the Kalman Filter strategy.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.KLFStrategyBacktester.calculate_signals_for_pairs">
<span class="sig-name descname"><span class="pre">calculate_signals_for_pairs</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#KLFStrategyBacktester.calculate_signals_for_pairs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.KLFStrategyBacktester.calculate_signals_for_pairs" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.KLFStrategyBacktester.calculate_xy_signals">
<span class="sig-name descname"><span class="pre">calculate_xy_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">et</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sqrt_Qt</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dt</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#KLFStrategyBacktester.calculate_xy_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.KLFStrategyBacktester.calculate_xy_signals" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.backtest.OUStrategyBacktester">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">OUStrategyBacktester</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bars</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#OUStrategyBacktester"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.OUStrategyBacktester" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></p>
<p>The <cite>OUBacktester</cite> class is a specialized trading strategy that implements
the Ornstein-Uhlenbeck (OU) process for mean-reverting financial time series.
This class extends the generic <cite>Strategy</cite> class provided by a backtesting framework
allowing it to integrate seamlessly with the ecosystem of data handling, signal generation
event management, and execution handling components of the framework.
The strategy is designed to operate on historical market data, specifically
targeting a single financial instrument (or a list of instruments)
for which the trading signals are to be generated.</p>
<p>Note:
This strategy is based on a stochastic process, so it is normal that every time
you run the backtest you get different results.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.OUStrategyBacktester.calculate_signals">
<span class="sig-name descname"><span class="pre">calculate_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#OUStrategyBacktester.calculate_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.OUStrategyBacktester.calculate_signals" title="Link to this definition"></a></dt>
<dd><p>Provides the mechanisms to calculate the list of signals.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.OUStrategyBacktester.create_signal">
<span class="sig-name descname"><span class="pre">create_signal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#OUStrategyBacktester.create_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.OUStrategyBacktester.create_signal" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.backtest.SMAStrategyBacktester">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">SMAStrategyBacktester</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bars</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">/</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#SMAStrategyBacktester"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.SMAStrategyBacktester" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Strategy</span></code></p>
<p>Carries out a basic Moving Average Crossover strategy bactesting with a
short/long simple weighted moving average. Default short/long
windows are 50/200 periods respectively and uses Hiden Markov Model
as risk Managment system for filteering signals.</p>
<p>The trading strategy for this class is exceedingly simple and is used to bettter
understood. The important issue is the risk management aspect (the Hmm model)</p>
<p>The Long-term trend following strategy is of the classic moving average crossover type.
The rules are simple:
-   At every bar calculate the 50-day and 200-day simple moving averages (SMA)
-   If the 50-day SMA exceeds the 200-day SMA and the strategy is not invested, then go long
-   If the 200-day SMA exceeds the 50-day SMA and the strategy is invested, then close the position</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.SMAStrategyBacktester.calculate_signals">
<span class="sig-name descname"><span class="pre">calculate_signals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#SMAStrategyBacktester.calculate_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.SMAStrategyBacktester.calculate_signals" title="Link to this definition"></a></dt>
<dd><p>Provides the mechanisms to calculate the list of signals.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.SMAStrategyBacktester.create_signal">
<span class="sig-name descname"><span class="pre">create_signal</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#SMAStrategyBacktester.create_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.SMAStrategyBacktester.create_signal" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.backtest.SMAStrategyBacktester.get_data">
<span class="sig-name descname"><span class="pre">get_data</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#SMAStrategyBacktester.get_data"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.SMAStrategyBacktester.get_data" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.backtest.run_backtest">
<span class="sig-prename descclassname"><span class="pre">btengine.backtest.</span></span><span class="sig-name descname"><span class="pre">run_backtest</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Ellipsis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Ellipsis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Ellipsis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Strategy</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">Ellipsis</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exc_handler</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">ExecutionHandler</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_capital</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">heartbeat</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_strategy</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'ou'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'sma'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'klf'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'arch'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'sma'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1000</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/backtest.html#run_backtest"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.backtest.run_backtest" title="Link to this definition"></a></dt>
<dd><p>Runs a backtest simulation based on a <cite>DataHandler</cite>, <cite>Strategy</cite> and <cite>ExecutionHandler</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>symbol_list</strong> (<em>List</em><em>[</em><em>str</em><em>]</em>) – List of symbol strings for the assets to be backtested.
This is required when <cite>test_mode</cite> is set to False.</p></li>
<li><p><strong>start_date</strong> (<em>datetime</em>) – Start date of the backtest. This is required when <cite>test_mode</cite> is False.</p></li>
<li><p><strong>data_handler</strong> (<a class="reference internal" href="#btengine.data.DataHandler" title="btengine.data.DataHandler"><em>DataHandler</em></a>) – <dl class="simple">
<dt>An instance of the <cite>DataHandler</cite> class, responsible for managing</dt><dd><p>and processing market data. Required when <cite>test_mode</cite> is False.
There are three DataHandler classes implemented in btengine module</p>
</dd>
<dt><cite>HistoricCSVDataHandler</cite>, <cite>MT5HistoricDataHandler</cite> and <cite>YFHistoricDataHandler</cite></dt><dd><p>See each of this class documentation for more details.
You can create your <cite>CustumDataHandler</cite> but it must be a subclass of <cite>DataHandler</cite>.</p>
</dd>
</dl>
</p></li>
<li><p><strong>strategy</strong> (<a class="reference internal" href="#btengine.strategy.Strategy" title="btengine.strategy.Strategy"><em>Strategy</em></a>) – The trading strategy to be employed during the backtest. Required when <cite>test_mode</cite> is False.
The strategy must be an instance of <cite>Strategy</cite> and it must have <cite>DataHandler</cite> and <cite>event queue</cite>
as required positional arguments to be used int the <cite>Backtest</cite> class. All other argument needed to be pass
to the strategy class must be in <cite>**kwargs</cite>. The strategy class must have <cite>calculate_signals</cite>
methods to generate <cite>SignalEvent</cite> in the backtest class.</p></li>
<li><p><strong>exc_handler</strong> (<a class="reference internal" href="#btengine.execution.ExecutionHandler" title="btengine.execution.ExecutionHandler"><em>ExecutionHandler</em></a>) – The execution handler for managing order executions. If not provided,
a <cite>SimulatedExecutionHandler</cite> will be used by default. Required when <cite>test_mode</cite> is False.
The <cite>exc_handler</cite> must be an instance of <cite>ExecutionHandler</cite> and must have <cite>execute_order`method
used to handle `OrderEvent</cite> in events queue in the <cite>Backtest</cite> class.</p></li>
<li><p><strong>initial_capital</strong> (<em>float</em><em>, </em><em>optional</em>) – The initial capital for the portfolio in the backtest. Default is 100,000.</p></li>
<li><p><strong>heartbeat</strong> (<em>float</em><em>, </em><em>optional</em>) – Time delay (in seconds) between iterations of the event-driven backtest loop.
Default is 0.0, allowing the backtest to run as fast as possible.
It could be also used as time frame in live trading engine (e.g 1m, 5m, 15m etc.) when listening
to a live market <cite>DataHandler</cite>.</p></li>
<li><p><strong>test_mode</strong> (<em>bool</em><em>, </em><em>optional</em>) – If set to True, the function runs a predefined backtest using a selected strategy
(<cite>ou</cite>, <cite>sma</cite>, <cite>klf</cite>, <cite>arch</cite>). Default is True.</p></li>
<li><p><strong>test_strategy</strong> (<em>Literal</em><em>[</em><em>'ou'</em><em>, </em><em>'sma'</em><em>, </em><em>'klf'</em><em>, </em><em>'arch'</em><em>]</em><em>, </em><em>optional</em>) – The strategy to use in test mode. Default is <cite>sma</cite>.
- <cite>ou</cite> Execute <cite>OUStrategyBacktester</cite>, for more detail see this class documentation.
- <cite>sma</cite> Execute <cite>SMAStrategyBacktester</cite>, for more detail see this class documentation.
- <cite>klf</cite> Execute <cite>KLFStrategyBacktester</cite>, for more detail see this class documentation.
- <cite>arch</cite> Execute <cite>ArimaGarchStrategyBacktester</cite>, for more detail see this class documentation.</p></li>
<li><p><strong>test_quantity</strong> (<em>int</em><em>, </em><em>optional</em>) – The quantity of assets to be used in the test backtest. Default is 1000.</p></li>
<li><p><strong>**kwargs</strong> – Additional parameters passed to the <cite>Backtest</cite> instance, which may include strategy-specific,
data handler, protfolio or execution handler options.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Usage:</dt><dd><ul class="simple">
<li><p>To run a predefined test backtest, set <cite>test_mode=True</cite> and select a strategy using <cite>test_strategy</cite>.</p></li>
<li><p>To customize the backtest, set <cite>test_mode=False</cite> and provide the required parameters (<cite>symbol_list</cite>,
<cite>start_date</cite>, <cite>data_handler</cite>, <cite>strategy</cite>, <cite>exc_handler</cite>).</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">bbstrader.btengine</span> <span class="kn">import</span> <span class="n">run_backtest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">run_backtest</span><span class="p">(</span><span class="n">test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">test_strategy</span><span class="o">=</span><span class="s1">&#39;ou&#39;</span><span class="p">,</span> <span class="n">test_quantity</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">run_backtest</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">symbol_list</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span> <span class="s1">&#39;GOOG&#39;</span><span class="p">],</span>
<span class="gp">... </span>    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">data_handler</span><span class="o">=</span><span class="n">CustomDataHandler</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">strategy</span><span class="o">=</span><span class="n">MovingAverageStrategy</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">exc_handler</span><span class="o">=</span><span class="n">CustomExecutionHandler</span><span class="p">(),</span>
<span class="gp">... </span>    <span class="n">initial_capital</span><span class="o">=</span><span class="mf">500000.0</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">heartbeat</span><span class="o">=</span><span class="mf">1.0</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</section>
<section id="module-btengine.data">
<span id="data"></span><h2>data<a class="headerlink" href="#module-btengine.data" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.data.</span></span><span class="sig-name descname"><span class="pre">BaseCSVDataHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">csv_dir</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.data.DataHandler" title="btengine.data.DataHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataHandler</span></code></a></p>
<p>Base class for handling data loaded from CSV files.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.get_latest_bar">
<span class="sig-name descname"><span class="pre">get_latest_bar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.get_latest_bar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.get_latest_bar" title="Link to this definition"></a></dt>
<dd><p>Returns the last bar from the latest_symbol list.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.get_latest_bar_datetime">
<span class="sig-name descname"><span class="pre">get_latest_bar_datetime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.get_latest_bar_datetime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.get_latest_bar_datetime" title="Link to this definition"></a></dt>
<dd><p>Returns a Python datetime object for the last bar.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.get_latest_bar_value">
<span class="sig-name descname"><span class="pre">get_latest_bar_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.get_latest_bar_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.get_latest_bar_value" title="Link to this definition"></a></dt>
<dd><p>Returns one of the Open, High, Low, Close, Volume or OI
values from the pandas Bar series object.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.get_latest_bars">
<span class="sig-name descname"><span class="pre">get_latest_bars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.get_latest_bars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.get_latest_bars" title="Link to this definition"></a></dt>
<dd><p>Returns the last N bars from the latest_symbol list,
or N-k if less available.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.get_latest_bars_values">
<span class="sig-name descname"><span class="pre">get_latest_bars_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.get_latest_bars_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.get_latest_bars_values" title="Link to this definition"></a></dt>
<dd><p>Returns the last N bar values from the
latest_symbol list, or N-k if less available.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.BaseCSVDataHandler.update_bars">
<span class="sig-name descname"><span class="pre">update_bars</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#BaseCSVDataHandler.update_bars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.BaseCSVDataHandler.update_bars" title="Link to this definition"></a></dt>
<dd><p>Pushes the latest bar to the latest_symbol_data structure
for all symbols in the symbol list.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.data.DataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.data.</span></span><span class="sig-name descname"><span class="pre">DataHandler</span></span><a class="reference internal" href="_modules/btengine/data.html#DataHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>One of the goals of an event-driven trading system is to minimise
duplication of code between the backtesting element and the live execution
element. Ideally it would be optimal to utilise the same signal generation
methodology and portfolio management components for both historical testing
and live trading. In order for this to work the Strategy object which generates
the Signals, and the <cite>Portfolio</cite> object which provides Orders based on them,
must utilise an identical interface to a market feed for both historic and live
running.</p>
<p>This motivates the concept of a class hierarchy based on a <cite>DataHandler</cite> object,
which givesall subclasses an interface for providing market data to the remaining
components within thesystem. In this way any subclass data handler can be “swapped out”,
without affecting strategy or portfolio calculation.</p>
<p>Specific example subclasses could include <cite>HistoricCSVDataHandler</cite>,
<cite>YFinanceDataHandler</cite>, <cite>FMPDataHandler</cite>, <cite>IBMarketFeedDataHandler</cite> etc.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.get_latest_bar">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_latest_bar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.get_latest_bar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.get_latest_bar" title="Link to this definition"></a></dt>
<dd><p>Returns the last bar updated.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.get_latest_bar_datetime">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_latest_bar_datetime</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.get_latest_bar_datetime"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.get_latest_bar_datetime" title="Link to this definition"></a></dt>
<dd><p>Returns a Python datetime object for the last bar.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.get_latest_bar_value">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_latest_bar_value</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_type</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.get_latest_bar_value"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.get_latest_bar_value" title="Link to this definition"></a></dt>
<dd><p>Returns one of the Open, High, Low, Close, Adj Close, Volume or Returns
from the last bar.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.get_latest_bars">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_latest_bars</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.get_latest_bars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.get_latest_bars" title="Link to this definition"></a></dt>
<dd><p>Returns the last N bars updated.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.get_latest_bars_values">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_latest_bars_values</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.get_latest_bars_values"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.get_latest_bars_values" title="Link to this definition"></a></dt>
<dd><p>Returns the last N bar values from the
latest_symbol list, or N-k if less available.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.data.DataHandler.update_bars">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">update_bars</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#DataHandler.update_bars"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.DataHandler.update_bars" title="Link to this definition"></a></dt>
<dd><p>Pushes the latest bars to the bars_queue for each symbol
in a tuple OHLCVI format: (datetime, Open, High, Low,
Close, Adj Close, Volume, Retruns).</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.data.HistoricCSVDataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.data.</span></span><span class="sig-name descname"><span class="pre">HistoricCSVDataHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#HistoricCSVDataHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.HistoricCSVDataHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.data.BaseCSVDataHandler" title="btengine.data.BaseCSVDataHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCSVDataHandler</span></code></a></p>
<p><cite>HistoricCSVDataHandler</cite> is designed to read CSV files for
each requested symbol from disk and provide an interface
to obtain the “latest” bar in a manner identical to a live
trading interface.</p>
<p>This class is useful when you have your own data or you want
to cutomize specific data in some form based on your <cite>Strategy()</cite> .</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.data.MT5HistoricDataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.data.</span></span><span class="sig-name descname"><span class="pre">MT5HistoricDataHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#MT5HistoricDataHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.MT5HistoricDataHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.data.BaseCSVDataHandler" title="btengine.data.BaseCSVDataHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCSVDataHandler</span></code></a></p>
<p>Downloads historical data from MetaTrader 5 (MT5) and provides
an interface for accessing this data bar-by-bar, simulating
a live market feed for backtesting.</p>
<p>Data is downloaded from MT5, saved as CSV files, and then loaded
using the functionality inherited from <cite>BaseCSVDataHandler</cite>.</p>
<p>This class is useful when you need to get data from specific broker
for different time frames.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.data.YFHistoricDataHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.data.</span></span><span class="sig-name descname"><span class="pre">YFHistoricDataHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol_list</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/data.html#YFHistoricDataHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.data.YFHistoricDataHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.data.BaseCSVDataHandler" title="btengine.data.BaseCSVDataHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseCSVDataHandler</span></code></a></p>
<p>Downloads historical data from Yahoo Finance and provides
an interface for accessing this data bar-by-bar, simulating
a live market feed for backtesting.</p>
<p>Data is fetched using the <cite>yfinance</cite> library and optionally cached
to disk to speed up subsequent runs.</p>
<p>This class is useful when working with historical daily prices.</p>
</dd></dl>

</section>
<section id="module-btengine.event">
<span id="event"></span><h2>event<a class="headerlink" href="#module-btengine.event" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.event.Event">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.event.</span></span><span class="sig-name descname"><span class="pre">Event</span></span><a class="reference internal" href="_modules/btengine/event.html#Event"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.Event" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Event is base class providing an interface for all subsequent
(inherited) events, that will trigger further events in the
trading infrastructure.
Since in many implementations the Event objects will likely develop greater
complexity, it is thus being “future-proofed” by creating a class hierarchy.
The Event class is simply a way to ensure that all events have a common interface
and can be handled in a consistent manner.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.event.FillEvent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.event.</span></span><span class="sig-name descname"><span class="pre">FillEvent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">timeindex</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exchange</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">direction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fill_cost</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">commission</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/event.html#FillEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.FillEvent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.event.Event" title="btengine.event.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a></p>
<p>When an <cite>ExecutionHandler</cite> receives an <cite>OrderEvent</cite> it must transact the order.
Once an order has been transacted it generates a <cite>FillEvent</cite>, which describes
the cost of purchase or sale as well as the transaction costs, such as fees
or slippage.</p>
<p>The <cite>FillEvent</cite> is the Event with the greatest complexity.
It contains a <cite>timestamp</cite> for when an order was filled, the <cite>symbol</cite>
of the order and the <cite>exchange</cite> it was executed on, the <cite>quantity</cite>
of shares transacted, the <cite>actual price of the purchase</cite> and the <cite>commission
incurred</cite>.</p>
<p>The commission is calculated using the Interactive Brokers commissions.
For US API orders this commission is <cite>1.30 USD</cite> minimum per order, with a flat
rate of either 0.013 USD or 0.08 USD per share depending upon whether
the trade size is below or above <cite>500 units</cite> of stock.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.event.FillEvent.calculate_ib_commission">
<span class="sig-name descname"><span class="pre">calculate_ib_commission</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/event.html#FillEvent.calculate_ib_commission"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.FillEvent.calculate_ib_commission" title="Link to this definition"></a></dt>
<dd><p>Calculates the fees of trading based on an Interactive
Brokers fee structure for API, in USD.
This does not include exchange or ECN fees.
Based on “US API Directed Orders”:
<a class="reference external" href="https://www.interactivebrokers.com/en/index.php?f=commission&amp;p=stocks2">https://www.interactivebrokers.com/en/index.php?f=commission&amp;p=stocks2</a></p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.event.MarketEvent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.event.</span></span><span class="sig-name descname"><span class="pre">MarketEvent</span></span><a class="reference internal" href="_modules/btengine/event.html#MarketEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.MarketEvent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.event.Event" title="btengine.event.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a></p>
<p>Market Events are triggered when the outer while loop of the backtesting
system begins a new <cite>“heartbeat”</cite>. It occurs when the <cite>DataHandler</cite> object
receives a new update of market data for any symbols which are currently
being tracked. It is used to <cite>trigger the Strategy object</cite> generating
new <cite>trading signals</cite>. The event object simply contains an identification
that it is a market event, with no other structure.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.event.OrderEvent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.event.</span></span><span class="sig-name descname"><span class="pre">OrderEvent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">order_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">direction</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/event.html#OrderEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.OrderEvent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.event.Event" title="btengine.event.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a></p>
<p>When a Portfolio object receives <cite>SignalEvents</cite> it assesses them
in the wider context of the portfolio, in terms of risk and position sizing.
This ultimately leads to <cite>OrderEvents</cite> that will be sent to an <cite>ExecutionHandler</cite>.</p>
<p>The <cite>OrderEvents</cite> is slightly more complex than a <cite>SignalEvents</cite> since
it contains a quantity field in addition to the aforementioned properties
of SignalEvent. The quantity is determined by the Portfolio constraints.
In addition the OrderEvent has a <cite>print_order()</cite> method, used to output the
information to the console if necessary.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.event.SignalEvent">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.event.</span></span><span class="sig-name descname"><span class="pre">SignalEvent</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">strategy_id</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbol</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">datetime</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_type</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quantity</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">strength</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">1.0</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/event.html#SignalEvent"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.event.SignalEvent" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.event.Event" title="btengine.event.Event"><code class="xref py py-class docutils literal notranslate"><span class="pre">Event</span></code></a></p>
<p>The <cite>Strategy object</cite> utilises market data to create new <cite>SignalEvents</cite>.
The SignalEvent contains a <cite>strategy ID</cite>, a <cite>ticker symbol</cite>, a <cite>timestamp</cite>
for when it was generated, a <cite>direction</cite> (long or short) and a <cite>“strength”</cite>
indicator (this is useful for mean reversion strategies) and the <cite>quantiy</cite>
to buy or sell. The <cite>SignalEvents</cite> are utilised by the <cite>Portfolio object</cite>
as advice for how to trade.</p>
</dd></dl>

</section>
<section id="module-btengine.execution">
<span id="execution"></span><h2>execution<a class="headerlink" href="#module-btengine.execution" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.execution.ExecutionHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.execution.</span></span><span class="sig-name descname"><span class="pre">ExecutionHandler</span></span><a class="reference internal" href="_modules/btengine/execution.html#ExecutionHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.execution.ExecutionHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>The ExecutionHandler abstract class handles the interaction
between a set of order objects generated by a Portfolio and
the ultimate set of Fill objects that actually occur in the
market.</p>
<p>The handlers can be used to subclass simulated brokerages
or live brokerages, with identical interfaces. This allows
strategies to be backtested in a very similar manner to the
live trading engine.</p>
<p>The ExecutionHandler described here is exceedingly simple,
since it fills all orders at the current market price.
This is highly unrealistic, but serves as a good baseline for improvement.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.execution.ExecutionHandler.execute_order">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">execute_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrderEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/execution.html#ExecutionHandler.execute_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.execution.ExecutionHandler.execute_order" title="Link to this definition"></a></dt>
<dd><p>Takes an Order event and executes it, producing
a Fill event that gets placed onto the Events queue.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<a class="reference internal" href="#btengine.event.OrderEvent" title="btengine.event.OrderEvent"><em>OrderEvent</em></a>) – Contains an Event object with order information.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="btengine.execution.SimulatedExecutionHandler">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.execution.</span></span><span class="sig-name descname"><span class="pre">SimulatedExecutionHandler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/execution.html#SimulatedExecutionHandler"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.execution.SimulatedExecutionHandler" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="#btengine.execution.ExecutionHandler" title="btengine.execution.ExecutionHandler"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExecutionHandler</span></code></a></p>
<p>The simulated execution handler simply converts all order
objects into their equivalent fill objects automatically
without latency, slippage or fill-ratio issues.</p>
<p>This allows a straightforward “first go” test of any strategy,
before implementation with a more sophisticated execution
handler.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.execution.SimulatedExecutionHandler.execute_order">
<span class="sig-name descname"><span class="pre">execute_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">OrderEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/execution.html#SimulatedExecutionHandler.execute_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.execution.SimulatedExecutionHandler.execute_order" title="Link to this definition"></a></dt>
<dd><p>Simply converts Order objects into Fill objects naively,
i.e. without any latency, slippage or fill ratio problems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>event</strong> (<a class="reference internal" href="#btengine.event.OrderEvent" title="btengine.event.OrderEvent"><em>OrderEvent</em></a>) – Contains an Event object with order information.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-btengine.performance">
<span id="performance"></span><h2>performance<a class="headerlink" href="#module-btengine.performance" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.create_drawdowns">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">create_drawdowns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">pnl</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#create_drawdowns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.create_drawdowns" title="Link to this definition"></a></dt>
<dd><p>Calculate the largest peak-to-trough drawdown of the PnL curve
as well as the duration of the drawdown. Requires that the
pnl_returns is a pandas Series.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>pnl</strong> – A pandas Series representing period percentage returns.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>drawdown, duration - high-water mark, duration.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>(tuple)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.create_sharpe_ratio">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">create_sharpe_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">252</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#create_sharpe_ratio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.create_sharpe_ratio" title="Link to this definition"></a></dt>
<dd><p>Create the Sharpe ratio for the strategy, based on a
benchmark of zero (i.e. no risk-free rate information).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> – A pandas Series representing period percentage returns.</p></li>
<li><p><strong>periods</strong> (<em>int</em>) – Daily (252), Hourly (252*6.5), Minutely(252*6.5*60) etc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sharpe ratio</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>S (float)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.create_sortino_ratio">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">create_sortino_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">returns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">periods</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">252</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#create_sortino_ratio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.create_sortino_ratio" title="Link to this definition"></a></dt>
<dd><p>Create the Sortino ratio for the strategy, based on a
benchmark of zero (i.e. no risk-free rate information).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>returns</strong> – A pandas Series representing period percentage returns.</p></li>
<li><p><strong>periods</strong> (<em>int</em>) – Daily (252), Hourly (252*6.5), Minutely(252*6.5*60) etc.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Sortino ratio</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>S (float)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.plot_monthly_yearly_returns">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">plot_monthly_yearly_returns</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#plot_monthly_yearly_returns"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.plot_monthly_yearly_returns" title="Link to this definition"></a></dt>
<dd><p>Plot the monthly and yearly returns of the strategy.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>)</p></li>
<li><p><strong>drawdowns.</strong> (<em>The DataFrame containing the strategy returns and</em>)</p></li>
<li><p><strong>title</strong> (<em>str</em>) – The title of the plot.</p></li>
</ul>
</dd>
</dl>
<p>Note:
The DataFrame should contain the following columns:
- Datetime : The timestamp of the data
- Equity Curve : The portfolio value
- Returns : The period returns
- Drawdown : The drawdowns
- Total : The total returns</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.plot_performance">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">plot_performance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#plot_performance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.plot_performance" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Plot the performance of the strategy:</dt><dd><ul class="simple">
<li><p>(Portfolio value,  %)</p></li>
<li><p>(Period returns, %)</p></li>
<li><p>(Drawdowns, %)</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>)</p></li>
<li><p><strong>drawdowns.</strong> (<em>The DataFrame containing the strategy returns and</em>)</p></li>
<li><p><strong>title</strong> (<em>str</em>) – The title of the plot.</p></li>
</ul>
</dd>
</dl>
<p>Note:
The DataFrame should contain the following columns
- Datetime: The timestamp of the data
- Equity Curve: The portfolio value
- Returns: The period returns
- Drawdown: The drawdowns
- Total : The total returns</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btengine.performance.plot_returns_and_dd">
<span class="sig-prename descclassname"><span class="pre">btengine.performance.</span></span><span class="sig-name descname"><span class="pre">plot_returns_and_dd</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">benchmark</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">title</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/performance.html#plot_returns_and_dd"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.performance.plot_returns_and_dd" title="Link to this definition"></a></dt>
<dd><p>Plot the returns and drawdowns of the strategy
compared to a benchmark.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> (<em>pd.DataFrame</em>) – The DataFrame containing the strategy returns and drawdowns.</p></li>
<li><p><strong>benchmark</strong> (<em>str</em>) – The ticker symbol of the benchmark to compare the strategy to.</p></li>
<li><p><strong>title</strong> (<em>str</em>) – The title of the plot.</p></li>
</ul>
</dd>
</dl>
<p>Note:
The DataFrame should contain the following columns:
- Datetime : The timestamp of the data
- Equity Curve : The portfolio value
- Returns : The period returns
- Drawdown : The drawdowns
- Total : The total returns</p>
</dd></dl>

</section>
<section id="module-btengine.portfolio">
<span id="portfolio"></span><h2>portfolio<a class="headerlink" href="#module-btengine.portfolio" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.portfolio.</span></span><span class="sig-name descname"><span class="pre">Portfolio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bars</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">DataHandler</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">events</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Queue</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_date</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">datetime</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">initial_capital</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100000.0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This  describes a <cite>Portfolio()</cite> object that keeps track of the positions
within a portfolio and generates orders of a fixed quantity of stock based on signals.
More sophisticated portfolio objects could include risk management and position
sizing tools (such as the <cite>Kelly Criterion</cite>).</p>
<p>The portfolio order management system is possibly the most complex component of
an eventdriven backtester.  Its role is to keep track of all current market positions
as well as the market value of the positions (known as the “holdings”).
This is simply an estimate of the liquidation value of the position and is derived in part
from the data handling facility of the backtester.</p>
<p>In addition to the positions and holdings management the portfolio must also be aware of
risk factors and position sizing techniques in order to optimise orders that are sent
to a brokerage or other form of market access.</p>
<p>Unfortunately, Portfolio and <cite>Order Management Systems (OMS)</cite> can become rather complex!
So let’s keep the <cite>Portfolio</cite> object relatively straightforward  anf improve it foward.</p>
<p>Continuing in the vein of the Event class hierarchy a Portfolio object must be able
to handle <cite>SignalEvent</cite> objects, generate <cite>OrderEvent</cite> objects and interpret <cite>FillEvent</cite>
objects to update positions. Thus it is no surprise that the Portfolio objects are often
the largest component of event-driven systems, in terms of lines of code (LOC).</p>
<p>The initialisation of the Portfolio object requires access to the bars <cite>DataHandler</cite>,
the  <cite>Event Queue</cite>, a <cite>start datetime stamp</cite> and an <cite>initial capital</cite>
value (defaulting to <cite>100,000 USD</cite>) and others parameter based on the <cite>Strategy</cite> requirement.</p>
<p>The <cite>Portfolio</cite> is designed to handle position sizing and current holdings,
but will carry out trading orders in a “dumb” manner by simply sending them directly
to the brokerage with a predetermined fixed quantity size, irrespective of cash held.
These are all unrealistic assumptions, but they help to outline how a portfolio order
management system (OMS) functions in an eventdriven fashion.</p>
<p>The portfolio contains the <cite>all_positions</cite> and <cite>current_positions</cite> members.
The former stores a list of all previous positions recorded at the timestamp of a market data event.
A position is simply the quantity of the asset held. Negative positions mean the asset has been shorted.</p>
<p>The latter current_positions dictionary stores contains the current positions
for the last market bar update, for each symbol.</p>
<p>In addition to the positions data the portfolio stores <cite>holdings</cite>,
which describe the current market value of the positions held. “Current market value”
in this instance means the closing price obtained from the current market bar,
which is clearly an approximation, but is reasonable enough for the time being.
<cite>all_holdings</cite> stores the historical list of all symbol holdings, while current_holdings
stores the most up to date dictionary of all symbol holdings values.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.construct_all_holdings">
<span class="sig-name descname"><span class="pre">construct_all_holdings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.construct_all_holdings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.construct_all_holdings" title="Link to this definition"></a></dt>
<dd><p>Constructs the holdings list using the start_date
to determine when the time index will begin.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.construct_all_positions">
<span class="sig-name descname"><span class="pre">construct_all_positions</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.construct_all_positions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.construct_all_positions" title="Link to this definition"></a></dt>
<dd><p>Constructs the positions list using the start_date
to determine when the time index will begin.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.construct_current_holdings">
<span class="sig-name descname"><span class="pre">construct_current_holdings</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.construct_current_holdings"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.construct_current_holdings" title="Link to this definition"></a></dt>
<dd><p>This constructs the dictionary which will hold the instantaneous
value of the portfolio across all symbols.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.create_equity_curve_dataframe">
<span class="sig-name descname"><span class="pre">create_equity_curve_dataframe</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.create_equity_curve_dataframe"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.create_equity_curve_dataframe" title="Link to this definition"></a></dt>
<dd><p>Creates a pandas DataFrame from the all_holdings
list of dictionaries.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.generate_naive_order">
<span class="sig-name descname"><span class="pre">generate_naive_order</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SignalEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.generate_naive_order"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.generate_naive_order" title="Link to this definition"></a></dt>
<dd><p>Simply files an Order object as a constant quantity
sizing of the signal object, without risk management or
position sizing considerations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>signal</strong> (<a class="reference internal" href="#btengine.event.SignalEvent" title="btengine.event.SignalEvent"><em>SignalEvent</em></a>) – The tuple containing Signal information.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.output_summary_stats">
<span class="sig-name descname"><span class="pre">output_summary_stats</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.output_summary_stats"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.output_summary_stats" title="Link to this definition"></a></dt>
<dd><p>Creates a list of summary statistics for the portfolio.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.update_fill">
<span class="sig-name descname"><span class="pre">update_fill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FillEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.update_fill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.update_fill" title="Link to this definition"></a></dt>
<dd><p>Updates the portfolio current positions and holdings
from a FillEvent.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.update_holdings_from_fill">
<span class="sig-name descname"><span class="pre">update_holdings_from_fill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fill</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FillEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.update_holdings_from_fill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.update_holdings_from_fill" title="Link to this definition"></a></dt>
<dd><p>Takes a Fill object and updates the holdings matrix to
reflect the holdings value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fill</strong> (<a class="reference internal" href="#btengine.event.FillEvent" title="btengine.event.FillEvent"><em>FillEvent</em></a>) – The Fill object to update the holdings with.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.update_positions_from_fill">
<span class="sig-name descname"><span class="pre">update_positions_from_fill</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fill</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">FillEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.update_positions_from_fill"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.update_positions_from_fill" title="Link to this definition"></a></dt>
<dd><p>Takes a Fill object and updates the position matrix to
reflect the new position.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>fill</strong> (<a class="reference internal" href="#btengine.event.FillEvent" title="btengine.event.FillEvent"><em>FillEvent</em></a>) – The Fill object to update the positions with.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.update_signal">
<span class="sig-name descname"><span class="pre">update_signal</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">SignalEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.update_signal"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.update_signal" title="Link to this definition"></a></dt>
<dd><p>Acts on a SignalEvent to generate new orders
based on the portfolio logic.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="btengine.portfolio.Portfolio.update_timeindex">
<span class="sig-name descname"><span class="pre">update_timeindex</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">event</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">MarketEvent</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/portfolio.html#Portfolio.update_timeindex"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.portfolio.Portfolio.update_timeindex" title="Link to this definition"></a></dt>
<dd><p>Adds a new record to the positions matrix for the current
market data bar. This reflects the PREVIOUS bar, i.e. all
current market data at this stage is known (OHLCV).
Makes use of a MarketEvent from the events queue.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-btengine.strategy">
<span id="strategy"></span><h2>strategy<a class="headerlink" href="#module-btengine.strategy" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="btengine.strategy.Strategy">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btengine.strategy.</span></span><span class="sig-name descname"><span class="pre">Strategy</span></span><a class="reference internal" href="_modules/btengine/strategy.html#Strategy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.strategy.Strategy" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A <cite>Strategy()</cite> object encapsulates all calculation on market data
that generate advisory signals to a <cite>Portfolio</cite> object. Thus all of
the “strategy logic” resides within this class. We opted to separate
out the <cite>Strategy</cite> and <cite>Portfolio</cite> objects for this backtester,
since we believe this is more amenable to the situation of multiple
strategies feeding “ideas” to a larger <cite>Portfolio</cite>, which then can handle
its own risk (such as sector allocation, leverage). In higher frequency trading,
the strategy and portfolio concepts will be tightly coupled and extremely
hardware dependent.</p>
<p>At this stage in the event-driven backtester development there is no concept of
an indicator or filter, such as those found in technical trading. These are also
good candidates for creating a class hierarchy.</p>
<p>The strategy hierarchy is relatively simple as it consists of an abstract
base class with a single pure virtual method for generating <cite>SignalEvent</cite> objects.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btengine.strategy.Strategy.calculate_signals">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">calculate_signals</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/btengine/strategy.html#Strategy.calculate_signals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#btengine.strategy.Strategy.calculate_signals" title="Link to this definition"></a></dt>
<dd><p>Provides the mechanisms to calculate the list of signals.</p>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="modules.html" class="btn btn-neutral float-left" title="bbstrader" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="metatrader.html" class="btn btn-neutral float-right" title="MetaTrader5 (MT5) Trading" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Bertin Balouki SIMYELI.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>